# План автоматизации тестирования сервиса покупки туров через интернет-банк

## 1. Перечень автоматизируемых сценариев

## UI-тесты

### Cценарии Happy Path:

#### Happy Path 1: Покупка тура через кнопку "Купить" с главной страницы сервиса.
<em>Cценарий 1.1: Оплата с помощью валидной карты, на которой есть достаточное количество денежных средств. Операция должна быть одобрена.</em>

![image](https://i.gyazo.com/8d89cddfdef32b3e99850c2a3c4b1df9.png)
![image](https://i.gyazo.com/e0b15483481f7bd6071a73a4b5ebca74.png)

Шаги по воспроизведению:
1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем форму заявки полностью валидными данными карты, на которой достаточно ДС: "Номер" = "4444 4444 4444 4441", "Месяц" = "10", 
"Год" = "22", "Владелец" = "Ivanov Petr", "CVV" = "111";
3. Нажимаем на кнопку "Продолжить";
4. Ожидаем результат после отправки запроса в банк.

<em>Ожидаемый результат: появляется уведомление "Успешно. Операция одобрена Банком".</em>

<em>Cценарий 1.2: Оплата с валидной карты, на которой недостаточное количество денежных средств. Отказ в проведении операции.</em>

Шаги по воспроизведению:
1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем форму заявки полностью валидными данными карты, на которой недостаточно ДС: "Номер" = "4444 4444 4444 4442", "Месяц" = "10", 
"Год" = "22", "Владелец" = "Ivanov Petr", "CVV" = "111";
3. Нажимаем на кнопку "Продолжить";
4. Ожидаем результат после отправки запроса в банк.

<em>Ожидаемый результат: появляется уведомление об ошибке "Ошибка! Банк отказал в проведении операции".</em>

#### Happy Path 2: Покупка тура через кнопку "Купить в кредит" с главной страницы сервиса.
<em>Cценарий 2.1: Оплата в кредит с помощью валидной карты, с достаточным кредитным лимитом. Операция должна быть одобрена.</em>

![image](https://i.gyazo.com/37fb626338bd7f958948ce8388ae528f.png)
![image](https://i.gyazo.com/e0b15483481f7bd6071a73a4b5ebca74.png)

Шаги по воспроизведению:
1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем форму заявки полностью валидными данными карты, на которой не исчерпан кредитный лимит: "Номер" = "4444 4444 4444 4441", "Месяц" = "10", 
"Год" = "22", "Владелец" = "Ivanov Petr", "CVV" = "111";
3. Нажимаем на кнопку "Продолжить";
4. Ожидаем результат после отправки запроса в банк.

<em>Ожидаемый результат: появляется уведомление "Успешно. Операция одобрена Банком".</em>

<em>Cценарий 2.2: Оплата в кредит с помощью валидной карты, с недостаточным кредитным лимитом. Отказ в проведении операции.</em>

Шаги по воспроизведению:
1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем форму заявки полностью валидными данными карты, на которой исчерпан кредитный лимит: "Номер" = "4444 4444 4444 4442", "Месяц" = "10", 
"Год" = "22", "Владелец" = "Ivanov Petr", "CVV" = "111";
3. Нажимаем на кнопку "Продолжить";
4. Ожидаем результат после отправки запроса в банк.

<em>Ожидаемый результат: появляется уведомление об ошибке "Ошибка! Банк отказал в проведении операции".</em>

------------

### Тестируем поля форм ввода данных

Каждый тестовый сценарий для тестирования формы ввода подразумевает стандартный путь захода на страницу формы 
(в зависимости от того, какую именно форму мы хотим протестировать):

- Для формы "Оплата по карте": на главной странице сервиса нажимаем на кнопку "Купить";
- Для формы "Кредит по данным карты": на главной странице сервиса нажимаем на кнопку "Купить в кредит";

После заполнения полей кликаем на кнопку "Продолжить" и ожидаем результат.
Так как позитивные сценарии покрываются сценариями Happy Path, то здесь и далее я буду писать только негативные, чтобы не дублировать

**Поле "Номер карты"**

Здесь и далее я буду писать одинаковые кейсы для форм, отличаться будут лишь пути захода.
Некоторые допущения по требованиям: поле принимает на вход только цифры, максимальное количество цифр — 16 (предположим, что здесь и далее я уточняю требования у руководства).

<em>Предусловия для формы "Купить":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем поля следующими валидными данными: "Месяц" = "10", "Год" = "22", "Владелец" = "Ivanov Petr", "CVV" = "111".

<em>Предусловия для формы "Купить в кредит":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить в кредит";
2. Заполняем поля следующими валидными данными: "Месяц" = "10", "Год" = "22", "Владелец" = "Ivanov Petr", "CVV" = "111".

<em>Негативные сценарии:</em> 

При вводе некорректных данных под полем ввода "Номер карты" должно появляться сообщение об ошибке ("Поле обязательно для заполнения", "Неверный формат" или "Ошибка! Банк отказал в проведении операции.", в зависимости от кейса).

1. Заявка не должна отправляться, если поле "Номер карты" пустое;
2. Заявка не должна отправляться, если поле "Номер карты" содержит 15 цифр (например, "4444 4444 4444 444");
3. Заявка не должна отправляться, если поле "Номер карты" содержит номер карты другого банка, которого нет в БД (например, "5559 4444 4444 4444").

**Поле "Месяц"**

Требования: данное поле принимает на вход номер месяца от 1 до 12, причем числам от 1 до 9 всегда предшествует 0, т.к. форма принимает только 2 числа.

<em>Предусловия для формы "Купить":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "22", "Владелец" = "Ivanov Petr", "CVV" = "111".

<em>Предусловия для формы "Купить в кредит":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить в кредит";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "22", "Владелец" = "Ivanov Petr", "CVV" = "111".

<em>Негативные сценарии:</em>

При вводе некорректных данных под полем ввода "Месяц" должно появляться сообщение об ошибке ("Поле обязательно для заполнения", "Неверно указан срок действия карты" или "Неверный формат" в зависимости от кейса).

1. Заявка не должна отправляться, если поле "Месяц" пустое;
2. Заявка не должна отправляться, если поле "Месяц" содержит нерелевантное значение (например, "00");
3. Заявка не должна отправляться, если поле "Месяц" содержит любое двузначное число, которое больше 12 (например, "13");
4. Заявка не должна отправляться, если поле "Месяц" содержит одну цифру (например, "1").

**Поле "Год"**

Требования: данное поле принимает на вход номер года в формате двух последних цифр.

<em>Предусловия для формы "Купить":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Месяц" = "10", "Владелец" = "Ivanov Petr", "CVV" = "111".

<em>Предусловия для формы "Купить в кредит":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить в кредит";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Месяц" = "10", "Владелец" = "Ivanov Petr", "CVV" = "111".

<em>Негативные сценарии:</em>

При вводе некорректных данных под полем ввода "Год" должно появляться сообщение об ошибке ("Поле обязательно для заполнения", "Неверно указан срок действия карты" или "Истёк срок действия карты" в зависимости от кейса).

1. Заявка не должна отправляться, если поле "Год" пустое;
2. Заявка не должна отправляться, если поле "Год" содержит цифры ранее текущего года (например, "19");
3. Заявка не должна отправляться, если поле "Год" содержит цифры намного позже текущего года (например, "50").

**Поле "Владелец"**

Требования: данное поле принимает на вход только фамилию и имя на латинском, первая буква в каждом из слов автоматически делается заглавной.

<em>Предусловия для формы "Купить":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "22", "Месяц" = "10", "CVV" = "111".

<em>Предусловия для формы "Купить в кредит":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить в кредит";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "22", "Месяц" = "10", "CVV" = "111".

<em>Негативные сценарии:</em>

При вводе некорректных данных под полем ввода "Владелец" должно появляться сообщение об ошибке ("Поле обязательно для заполнения" или "Неверный формат" в зависимости от кейса).

1. Заявка не должна отправляться, если поле "Владелец" пустое;
2. Заявка не должна отправляться, если поле "Владелец" содержит одно слово на латинице (например, "Ivanov");
3. Заявка не должна отправляться, если поле "Владелец" содержит три слова на латинице (например, "Ivanov Petr Ivanovich");
4. Заявка не должна отправляться, если поле "Владелец" содержит фамилию и имя в нижнем регистре (например, "ivanov petr");
5. Заявка не должна отправляться, если поле "Владелец" содержит фамилию и имя в верхнем регистре (например, "IVANOV PETR");
6. Заявка не должна отправляться, если поле "Владелец" содержит фамилию и имя на кириллице (например, "Иванов Петр");
7. Заявка не должна отправляться, если поле "Владелец" содержит цифры (например, "12345");
8. Заявка не должна отправляться, если поле "Владелец" содержит нерелевантные символы (например, "%№%№").

**Поле "CVV"**

Требования: данное поле принимает на вход только 3 цифры.

<em>Предусловия для формы "Купить":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "22", "Месяц" = "10", "Владелец" = "Ivanov Petr".

<em>Предусловия для формы "Купить в кредит":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить в кредит";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "22", "Месяц" = "10", "Владелец" = "Ivanov Petr".

<em>Негативные сценарии:</em>

При вводе некорректных данных под полем ввода "CVV" должно появляться сообщение об ошибке ("Поле обязательно для заполнения" или "Неверный формат" в зависимости от кейса).

1. Заявка не должна отправляться, если поле "CVV" пустое;
2. Заявка не должна отправляться, если поле "CVV" содержит одну цифру (например, "1");
3. Заявка не должна отправляться, если поле "CVV" содержит две цифры (например, "11").

## API-тесты

Необходимо убедиться, что при попытке обратиться к приложению через API сервис отдает те же данные, что и при UI-тестах. Для этого будут необходимы 4 теста, которые проверяют разные карты и статус этих карт в БД при обращении напрямую к Payment Gate и Credit Gate.

<em>Предусловия для валидной карты со статусом APPROVED:</em> 

"Номер" = "4444 4444 4444 4441", "Месяц" = "10", "Год" = "22", "Владелец" = "Ivanov Petr", "CVV" = "111".

<em>Предусловия для валидной карты со статусом DECLINED:</em> 

"Номер" = "4444 4444 4444 4442", "Месяц" = "10", "Год" = "22", "Владелец" = "Ivanov Petr", "CVV" = "111".

**Тест-кейсы**
1. Удостоверяемся, что при обращении к URL-адресу http://localhost:8080/api/v1/pay мы получаем код ответа сервера 200 и банковская карта c номером "4444 4444 4444 4441" отдает статус APPROVED.
2. Удостоверяемся, что при обращении к URL-адресу http://localhost:8080/api/v1/pay мы получаем код ответа сервера 200 и банковская карта с номером "4444 4444 4444 4442" отдает статус DECLINED.
3. Удостоверяемся, что при обращении к URL-адресу http://localhost:8080/api/v1/credit мы получаем код ответа сервера 200 и банковская карта c номером "4444 4444 4444 4441" отдает статус APPROVED.
4. Удостоверяемся, что при обращении к URL-адресу http://localhost:8080/api/v1/credit мы получаем код ответа сервера 200 и банковская карта с номером "4444 4444 4444 4442" отдает статус DECLINED.

## 2. Перечень используемых инструментов

- **IntelliJ IDEA CE**

Многофункциональная среда разработки, подходящая как новичку, так и профессионалу. IDEA — это мощнейший редактор кода, содержащий в себе много различных встроенных инструментов, интеграцию с системами контроля версий, "умное" автодополнение кода, возможность разработки на различных языках программирования и много другое.

- **Java 11**

Язык программирования на котором будет написан проект. По статистике Java является одним из самых популярных языков программирования в мире, это широко распространенный 
и универсальный язык, на котором написано огромное множество сайтов, приложений и даже софта (для умных домов, например). 

- **Gradle**

Системой сборки проекта будет Gradle (в качестве альтернативного варианта можно использовать Maven). 
Причины: быстрота сборки (пример cравнения с Maven [здесь](https://gradle.org/maven-vs-gradle/)), 
гибкость самой системы, производительность, UX (сравнивая build.gradle и pom.xml я отдаю предпочтение build.gradle за простоту и минимум кода).

- **Git**

Любому современному проекту будет необходима система контроля версий и Git — это как раз то, что нужно. 
В Git можно откатиться к предыдущему билду, можно вести параллельную разработку через систему веток, есть интеграция с IDEA.

- **JUnit-5**

Тестовым фреймворком в нашем случае будет JUnit, т.к. это один из наиболее популярный тестовых фреймворков на данный момент и обладает всем нужным функционалом и аннотациями.

- **Selenide**

Фреймворк для тестирования веб-приложений на основе Selenium WebDriver. Его плюсы, в основном, в удобстве — веб-драйвер "из коробки", 
сокращается время написания тестов и количество строк кода.

- **Lombok**

Lombok — это полезный плагин, аннотации которого позволят опять-таки сократить время написания кода и количество строк кода за 
счет автоматически генерируемых конструкторов, getter'ов/setter'ов и т.п.

- **JavaFaker**

Плагин, позволяющий генерировать тестовые данные — имя, пароль и т.п. 
Позволит решить проблему, когда необходимо где-то брать тестовые данные, чтобы не хардкодить их в методы.

- **Docker**

Через Docker мы будем использовать те приложения, установка и использование которых "в натуральном виде" может повлечь за собой некоторые риски в процессе автоматизации
и требует определенных навыков. Через Docker мы развертываем **СУБД MySQL и PostgreSQL**, т.к. заявлено, что сервис покупки туров поддерживает именно эти две СУБД, а также **Node.js** для того, что запускать симуляцию сервисов банка, написанных с помощью Node.js.

- **Allure**

Для просмотра расширенного отчета о прохождении тестов будем использовать Allure, т.к. в нем заложен значительно больший функционал по сравнению со стандартным отчетом Gradle.


## 3. Перечень и описание возможных рисков при автоматизации

- Технические сложности с настройкой Docker-compose.yml и SUT — возможные проблемы с "поднятием" БД, SUT не запускается и т.п.;

- Сложности к раздельным подключением тестов через БД MySQL и PostgreSQL;

- Ложные срабатывания тестов из-за некорректно сгенерированных данных Faker'ом;

- Если в будущем будет переделан дизайн, фирменный стиль сайта (либо просто изменены какие-то данные), то тесты могут не проходить. К примеру, можно изначально привязаться с exactText к одному тексту, а если его изменят на другой, то тесты уже не будут проходить;

- Сложности с поиском и привязкой к необходимым CSS-селекторам для Selenide.

## 4. Интервальная оценка с учётом рисков (в часах)

- Подготовка к проведению тестирования — 8 часов;
- Написание кода + рефакторинг — 48 часов;
- Резерв времени на написание баг-репортов — 8 часов;
- Подготовка отчета о результатах прогона тестов — 8 часов;
- Подготовка комплексного отчета по всему процессу автоматизации тестирования — 16 часов;

## 5. План сдачи работ

- Готовность авто-тестов — через 6 рабочих дней после согласования плана;
- Подготовка отчетов по итогам прогона тестов — через 2 рабочих дня после прогона тестов;
- Подготовка комплексного отчета по итогам автоматизации — через 2 рабочих дня после отчетов по прогону и написания баг-репортов.
